# cinema-backend

Бэкенд сайта кинотеатра для курсовой работы по управлению разработкой информационных систем.

Написан на Node.js с использованием Restify. База данных на PostgreSQL.

[Репозиторий с фронтендом](https://github.com/staskozin/cinema-frontend)

## Методы
### GET /movie
Получить список всех фильмов
```json
[
  {
    "movie_id": 1015471,
    "movie_name": "Райя и последний дракон",
    "poster": "img/poster/1015471.jpg",
    "premiere_date": "2021-03-03T21:00:00.000Z",
    "age_restriction": 6,
    "duration": "01:47:00",
    "description": "Давным-давно в волшебной стране Кумандре бок о бок с людьми жили драконы — создатели и хранители воды. Мирной жизни пришел конец, когда появились друуны. Порождения тьмы обращали людей и драконов в каменные изваяния, и только магия драконихи Сису смогла прогнать злых созданий и расколдовать людей, но на драконов не подействовала. Кумандра раскололась на государства Сердца, Клыка, Когтя, Хребта и Хвоста, а волшебный драконий камень хранился в стране Сердца, которой правил отец Райи. Он мечтал объединить земли, но из-за человеческой жадности и зависти артефакт раскололся. Правитель каждой страны заполучил по осколку, а друуны снова стали властвовать безраздельно.<br>Несколько лет спустя Райя и её верный спутник Тук-Тук бесстрашно колесят по выжженной пустыне, исследуя оставшиеся реки и не теряя надежды найти последнего дракона — последнюю надежду людей одержать победу над друунами.",
    "country": "США",
    "director": "Дон Холл, Карлос Лопес Эстрада, Пол Бриггс, John Ripa",
    "genre": "мультфильм, фэнтези, боевик, комедия, приключения, семейный",
    "youtube_trailer": "2G2KYvJdfCI"
  }
]
```
### GET /movie/id
Получить фильм по id Кинопоиска
```json
{
  "movie_id": 1015471,
  "movie_name": "Райя и последний дракон",
  "poster": "img/poster/1015471.jpg",
  "premiere_date": "2021-03-03T21:00:00.000Z",
  "age_restriction": 6,
  "duration": "01:47:00",
  "description": "Давным-давно в волшебной стране Кумандре бок о бок с людьми жили драконы — создатели и хранители воды. Мирной жизни пришел конец, когда появились друуны. Порождения тьмы обращали людей и драконов в каменные изваяния, и только магия драконихи Сису смогла прогнать злых созданий и расколдовать людей, но на драконов не подействовала. Кумандра раскололась на государства Сердца, Клыка, Когтя, Хребта и Хвоста, а волшебный драконий камень хранился в стране Сердца, которой правил отец Райи. Он мечтал объединить земли, но из-за человеческой жадности и зависти артефакт раскололся. Правитель каждой страны заполучил по осколку, а друуны снова стали властвовать безраздельно.<br>Несколько лет спустя Райя и её верный спутник Тук-Тук бесстрашно колесят по выжженной пустыне, исследуя оставшиеся реки и не теряя надежды найти последнего дракона — последнюю надежду людей одержать победу над друунами.",
  "country": "США",
  "director": "Дон Холл, Карлос Лопес Эстрада, Пол Бриггс, John Ripa",
  "genre": "мультфильм, фэнтези, боевик, комедия, приключения, семейный",
  "youtube_trailer": "2G2KYvJdfCI"
}
```

### GET /showtime
Получить список всех сеансов
```json
[
  {
    "showtime_id": 1,
    "showtime_date": "2021-06-03T08:45:00.000Z",
    "showtime_end_date": "2021-06-03T10:18:00.000Z",
    "price": 175,
    "movie_id": 1266725,
    "hall_id": 1,
    "hall_name": "Зал №1",
    "movie_name": "Пила: Спираль",
    "age_restriction": 18,
    "seats": [
      [
        {
          "seat_id": 1,
          "seat_status_id": 1,
          "seat_status_name": "Свободно",
          "seat_row": 1,
          "seat_number": 1,
          "seat_status_date": "2021-04-30T21:00:00.000Z"
        }
      ]
    ]
  }
]
```

### GET /showtime/id
Получить сеанс по id
```json
{
  "showtime_id": 1,
  "showtime_date": "2021-06-03T08:45:00.000Z",
  "showtime_end_date": "2021-06-03T10:18:00.000Z",
  "price": 175,
  "movie_id": 1266725,
  "hall_id": 1,
  "hall_name": "Зал №1",
  "movie_name": "Пила: Спираль",
  "age_restriction": 18,
  "seats": [
    [
      {
        "seat_id": 1,
        "seat_status_id": 1,
        "seat_status_name": "Свободно",
        "seat_row": 1,
        "seat_number": 1,
        "seat_status_date": "2021-04-30T21:00:00.000Z"
      }
    ]
  ]
}
```

### GET /showtime/movie/movie_id
Получить список всех сеансов фильма
```json
[
  {
    "showtime_id": 1,
    "showtime_date": "2021-06-03T08:45:00.000Z",
    "showtime_end_date": "2021-06-03T10:18:00.000Z",
    "price": 175,
    "movie_id": 1266725,
    "hall_id": 1,
    "hall_name": "Зал №1",
    "movie_name": "Пила: Спираль",
    "age_restriction": 18,
    "seats": [
      [
        {
          "seat_id": 1,
          "seat_status_id": 1,
          "seat_status_name": "Свободно",
          "seat_row": 1,
          "seat_number": 1,
          "seat_status_date": "2021-04-30T21:00:00.000Z"
        }
      ]
    ]
  }
]
```

### GET /reservation
Получить список всех бронирований
```json
[
  {
    "reservation_id": 2,
    "phone": "+7 123 456-78-90",
    "showtime_id": 1,
    "showtime_date": "2021-06-03T08:45:00.000Z",
    "showtime_end_date": "2021-06-03T10:18:00.000Z",
    "price": 175,
    "movie_id": 1266725,
    "hall_id": 1,
    "hall_name": "Зал №1",
    "seat_count": 2,
    "movie_name": "Пила: Спираль",
    "age_restriction": 18
  }
]
```

### GET /reservation/id
Получить список бронирования по id
```json
{
  "reservation_id": 2,
  "phone": "+7 123 456-78-90",
  "showtime_id": 1,
  "showtime_date": "2021-06-03T08:45:00.000Z",
  "showtime_end_date": "2021-06-03T10:18:00.000Z",
  "price": 175,
  "movie_id": 1266725,
  "hall_id": 1,
  "hall_name": "Зал №1",
  "seat_count": 2,
  "movie_name": "Пила: Спираль",
  "age_restriction": 18
}
```

### POST /reserve
Забронировать места на сеанс

Тело запроса:
```json
{
  "showtime_id": 1,
  "seats": [1, 2, 3],
  "phone": "+7 123 456-78-90"
}
```

Ответ сервера:
```json
{
  "reservation_id": 1
}
```
